<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.8.0/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />

  <script src="./assetsMileStone2/cleanStage2.geojson"></script>

    <title>CSC3007 Milestone 2</title>

  <style>
/*
    #mainDiv {
width: 600px;
background: #CCCCCC;
align-items: center;
justify-content: center;
    }*/

      #map {

    height: 750px;
      width: 1200px;
      margin: auto;

  }
  </style>
</head>
  
  <body>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.8.0/leaflet.js"></script>
            <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <div style="text-align: center;">
<!--     <div id = "mainDiv">
 -->
    <h1 style = "text-align: center; font-weight: bold">Singapore's E-waste Report</h1>
    <h4 style = "text-align: center; font-weight: bold">With many green and sustainability initiatives in Singapore  – TowardsZeroWasteSG, Closing the Waste Loop, Zero Waste Masterplan in recent years to support a Clean and Green Singapore, we explore and take a look at whether the e-waste situation in Singapore have been doing well or not.</h4>


    <h4> 
      (1) E-waste bins around Singapore </br>
    </h4>
    <div id="map"></div>

    <h4>
      (2) Pie Chart
    </h4>

    <h4>
<!--      (3) Inflation -->
    </h4>
<!-- </div> -->
</div>
  </body>

 
  <footer>

  <script>

    //Functions for the map to show density and add styling
      function colourPopDens(d) {
            return d > 35000 ? '#b30000' :
                d > 25000 ? '#e34a33' :
                    d > 20000 ? '#fc8d59' :
                        d > 10000 ? '#fdcc8a' :
                            d > 1 ? '#fef0d9' :
                                '#fff';
      }

      function style(feature) {
            return {
                fillColor: colourPopDens(feature.properties.population),
                weight: 1,
                opacity: 1,
                color: "black",
                fillOpacity: 0.65
            };
      }

      function popUp(feature, layer) {
            layer.bindPopup(`
      <b> Subzone: </b> ${feature.properties.subZoneName} <br>
      <b> Planning Area: </b> ${feature.properties.planningAreaName} <br>
      <b> Population: </b> ${(feature.properties.population)} <br>
      `)
            layer.on('click', function () { layer.openPopup(); })
      }


   let tiles = new L.tileLayer('https://maps-{s}.onemap.sg/v3/Default/{z}/{x}/{y}.png', {
      detectRetina: true,
      maxZoom: 18,
      minZoom: 9,
      maxBounds: L.latLngBounds(L.latLng(1.1, 103.5), L.latLng(1.5, 104.3)),
      //Do not remove this attribution
      attribution: '<img src="https://docs.onemap.sg/maps/images/oneMap64-01.png" style="height:20px;width:20px;">' +
                   'New OneMap | Map data © contributors, <a href="http://SLA.gov.sg">Singapore Land Authority</a>'
    });
    let map = new L.Map('map', {center: [1.3521, 103.8198], zoom: 12})
        .addLayer(tiles);

        //Add subzone layers from geoJSON
   L.geoJSON(singaporePopulation, {
          style: style,
          onEachFeature: popUp
      }).addTo(map);
      


    const token = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOjkwMzUsInVzZXJfaWQiOjkwMzUsImVtYWlsIjoidW5rbm93bmZhbWVAaG90bWFpbC5jb20iLCJmb3JldmVyIjpmYWxzZSwiaXNzIjoiaHR0cDpcL1wvb20yLmRmZS5vbmVtYXAuc2dcL2FwaVwvdjJcL3VzZXJcL3Nlc3Npb24iLCJpYXQiOjE2NTg3MzgzOTAsImV4cCI6MTY1OTE3MDM5MCwibmJmIjoxNjU4NzM4MzkwLCJqdGkiOiIzMTE1NzczZDJlNTVkYWNkNGVmNGZlN2U5YjZiMzAzZSJ9.YwVZDxosJcDfW-C7opbsEaxHagplqsgF2K58BhqcwTw"



      //Add marker cluster using e-waste bins data
    fetch('https://developers.onemap.sg//privateapi/themesvc/retrieveTheme?queryName=ewaste_new&token=' + token)
    .then(response => response.json())
    .then(data => { 
        // console.log("data" , data.SrchResults);

        var markers = L.markerClusterGroup({ chunkedLoading: true });

        for (let i = 1; i < data.SrchResults.length; i++) {
          // console.log("index ", i);
          const item = data.SrchResults[i];
          const buildingName = item.ADDRESSBUILDINGNAME;
          const postalCode = item.ADDRESSPOSTALCODE;
          const lat= item.LatLng.split(",")[0];
          const lng= item.LatLng.split(",")[1];

          // console.log("item", item);
          
        var marker = L.marker(L.latLng(lat,lng));


          //bind popup
        marker.bindPopup(`
              <b> Building Name: </b> ${buildingName} <br>
              <b> Planning Area: </b> ${postalCode} <br>
              `)

        markers.addLayer(marker);
        }
        map.addLayer(markers);

    });
    
    // for (var i = 0; i < addressPoints.length; i++) {
    //   var a = addressPoints[i];
    //   var title = a[2];
    //   var marker = L.marker(L.latLng(a[0], a[1]), { title: title });
    //   marker.bindPopup(title);
    //   markers.addLayer(marker);
    // }

    // map.addLayer(markers);

    </script>
  </footer>
</html>
